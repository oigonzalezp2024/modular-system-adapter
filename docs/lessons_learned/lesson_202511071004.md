# Lección Aprendida: Diagnóstico y Solución de Fallos de Conexión de APT

## 1. El Problema Inicial: El Engaño del *Ping*

| Comando y Error | Diagnóstico Inicial |
| :--- | :--- |
| **`sudo apt install unzip`** falla con errores `connect (101: Network is unreachable)` o `caducó el tiempo para conexión`. | La primera hipótesis es una falla de red (cable, firewall, DNS). |
| **`ping google.com`** responde con éxito. | **Descartada la falla de red total.** El sistema tiene conexión y DNS funciona. El problema es específico de cómo se conecta `apt` a los servidores de Ubuntu. |

## 2. El Diagnóstico Profundo: La Prioridad de APT

El análisis de los mensajes de error de `apt update` mostró dos patrones de fallo persistentes, incluso después de cambiar el espejo de Colombia a la URI principal (`archive.ubuntu.com`):

* **Fallo de Conexión IPv6:** La mayoría de los errores mostraban intentos fallidos a direcciones `2620:...` y el error `Network is unreachable`. Esto indica que, aunque tu sistema tiene IPv6 habilitado, la red real no lo soporta o lo bloquea, lo que hace que `apt` pierda tiempo intentando usarlo.
* **Fallo de Conexión HTTP (Puerto 80):** Todos los intentos fallaban al conectarse al puerto **`80`** (`http://...`).

## 3. Antecedentes

**Se ha configurado el firewall para que solo consultara sitios con ssl**.

* La mayoría de los servidores de repositorio de Linux siguen permitiendo o prefiriendo la descarga inicial por **HTTP (puerto 80)**.
* Si un *firewall*, un *proxy*, o una regla de seguridad en tu entorno (como una máquina virtual o un contenedor) **bloquea el puerto 80**, `apt` y `apt-get` no podrá actualizar sus listas ni descargar paquetes.

## 4. La Solución Definitiva: Forzar HTTPS

La solución fue alinear la configuración del gestor de paquetes (`apt`) con la restricción de seguridad de tu entorno: forzar el uso del protocolo seguro HTTPS (puerto 443).

| **Acción Realizada** | **Impacto** |
| :--- | :--- |
| **Editar `/etc/apt/sources.list.d/ubuntu.sources`** | Se localizó el archivo de configuración real de los repositorios. |
| **Reemplazar `http` por `https`** | Se cambió la URI de descarga de `http://...` a `https://...` en los servidores de Ubuntu, lo que obliga a `apt` a usar el puerto 443, el único permitido por tu configuración de seguridad. |
| **`sudo apt update`** exitoso. | Se confirmó que la conexión por el puerto 443 está abierta y es funcional, resolviendo inmediatamente el problema. |

### **Conclusión de la Lección**

El diagnóstico de fallos de `apt` requiere revisar la conectividad a dos niveles:

1.  **Conectividad de red básica (`ping`):** ¿El sistema puede llegar a un servidor?
2.  **Conectividad de protocolo específica (el puerto):** ¿Está la red permitiendo el puerto que el gestor de paquetes intenta usar (generalmente HTTP/80 o HTTPS/443)?

Cuando el `ping` funciona, pero `apt` falla, casi siempre se trata de una restricción de *firewall* o una mala configuración de `sources.list` que ignora el protocolo seguro.